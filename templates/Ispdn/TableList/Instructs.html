{% extends 'base.html' %}
{% load modified %}

{% block title %}{{ otdel.name }} | ПГУ им. "Шолом-Алейхема"{% endblock %}

{% block content %}
    <div class="ui container">
        <div class="child-center">
            <div class="skzi-list cblock">
                <div class="content">
                    <h1 class="ui center aligned header">Инструкции {% if ispdn %}{{ ispdn.name }}{% endif %}</h1>
                    <div class="panel">
                        <div class="buttons left">
                            {% if ispdn %}
                                <a href="{% iurl 'ispdn:instruct_form' get_source='ispdn.id' %}" class="button primary ui medium">Добавить новый</a>
                                <a href="{% url 'ispdn:instructs_all' %}" class="button primary ui medium">Список всех инструкций</a>
                            {% else %}
                                <a href="{% iurl 'ispdn:instruct_form' %}" class="button primary ui medium">Добавить новый</a>
                                {% for ispdn in ispdns %}
                                    <a href="{% iurl 'ispdn:instructs' ispdn_id='ispdn.id' %}" class="button primary ui medium">{{ ispdn.name }}</a>
                                {% endfor %}
                            {% endif %}
                        </div>
                    </div>
                    <div class="sixteen wide table-container">
                        <div class="table-width">
                            <table class="ui celled selectable sortable table tableFixHead">
                                <thead>
                                <tr>
                                    <th>#</th>
                                    <th>Номер</th>
                                    <th>Название</th>
                                    <th>Ответственный</th>
                                    <th class="center aligned">Скачать</th>
                                </tr>
                                </thead>
                                <tbody>
                                {% for instruct in instances %}
                                    <tr data-id="{{ instruct.id }}">
                                        <td data-label="#">{{ instances|length|substract:forloop.counter0 }}</td>
                                        <td data-label="Номер">{{ instruct.nomer }}</td>
                                        <td data-label="Название">{{ instruct.name }}</td>
                                        <td data-label="Ответственный">{{ instruct.ovetstv.get_fio }}</td>
                                        <td data-label="Скачать" class="center aligned"><a class="ui button primary tiny download" href="{% iurl 'ispdn:instruct_download' id='instruct.id' %}">Скачать</a></td>
                                    </tr>
                                {% endfor %}
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
{% endblock %}
{% block script %}
    <script type="text/javascript">
        $(document).ready(function () {
            $('.button:not(.download)').click(function () {
                $(this).addClass('loading')
            });
            $('tbody tr').click(function () {
                var id = $(this).attr('data-id')
                {% if ispdn %}
                    window.location.href = '{% url 'ispdn:instruct_form' %}' + id + '/?source={{ ispdn.id }}'
                {% else %}
                    window.location.href = '{% url 'ispdn:instruct_form' %}' + id + '/'
                {% endif %}
            })
            $('table').tablesort()
        })
    </script>
{% endblock %}